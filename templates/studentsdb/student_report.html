{% extends "base.html" %}
{% load core_tags %}
{% block title %}Student Report{% endblock %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/student_report.css' %}">
{% endblock %}

{% block content %}
<div class="student-report-container">
    <!-- Header Section -->
    <div class="sr-header">
        <div class="sr-institute-info">
            <div class="sr-logo">
                <img src="{% static 'images/logo.png' %}" alt="Institute Logo">
                <span>{{ request.site_settings.site_name|default:"Kafka Institute" }}</span>
            </div>
            <div class="sr-date">
                <span>{{ today|date:"l, d F Y" }}</span>
            </div>
        </div>
        
        <div class="sr-student-info">
            <h1>{{ student.first_name }} {{ student.last_name }}</h1>
            <div class="sr-language-selector">
                <select class="sr-language-dropdown">
                    <option value="en">English speaking 101</option>
                </select>
                <div class="sr-actions">
                    <button class="sr-download-btn"><i class="fas fa-download"></i></button>
                    <button class="sr-share-btn"><i class="fas fa-share-alt"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="sr-content">
        <!-- Profile Section -->
        <div class="sr-card">
            <div class="sr-card-header">Profile</div>
            <div class="sr-card-body">
                <div class="sr-profile-content">
                    <div class="sr-profile-photo">
                        {% if placement.std_professional_photo %}
                            <img src="{{ placement.std_professional_photo.url }}" alt="Student Photo">
                        {% else %}
                            <div class="sr-profile-placeholder">
                                <i class="fas fa-user"></i>
                            </div>
                        {% endif %}
                    </div>
                    <div class="sr-profile-details">
                        <div class="sr-detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Date of Birth</span>
                            <span class="sr-detail-value">{{ student.date_of_birth|date:"d-m-Y"|default:"Not provided" }}</span>
                        </div>
                        <div class="sr-detail-item">
                            <i class="fas fa-phone"></i>
                            <span>Phone</span>
                            <span class="sr-detail-value">{{ student.country_code }} {{ student.phone }}</span>
                        </div>
                        <div class="sr-detail-item">
                            <i class="fas fa-envelope"></i>
                            <span>Email</span>
                            <span class="sr-detail-value">{{ student.email }}</span>
                        </div>
                        <div class="sr-detail-item">
                            <i class="fas fa-calendar-check"></i>
                            <span>Date of joining</span>
                            <span class="sr-detail-value">{{ student.enrollment_date|date:"d-m-Y" }}</span>
                        </div>
                        <div class="sr-detail-item">
                            <i class="fas fa-clock"></i>
                            <span>Last active</span>
                            <span class="sr-detail-value">{{ student.last_updated|timesince }} ago</span>
                        </div>
                    </div>
                </div>
                <div class="sr-profile-actions">
                    <button class="sr-edit-profile-btn">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
            </div>
        </div>

        <!-- Sessions Completed Section -->
        <div class="sr-card">
            <div class="sr-card-header">Sessions completed</div>
            <div class="sr-card-body">
                <div class="sr-sessions-progress">
                    <div class="sr-progress-circle">
                        <svg width="120" height="120" viewBox="0 0 120 120">
                            <circle cx="60" cy="60" r="54" fill="none" stroke="#e6e6e6" stroke-width="12" />
                            <circle cx="60" cy="60" r="54" fill="none" stroke="#4CAF50" stroke-width="12" 
                                stroke-dasharray="339.292" stroke-dashoffset="{{ 339.292|multiply_with:1|floatformat:2 }}" />
                            <text x="60" y="60" text-anchor="middle" dominant-baseline="middle" font-size="24" font-weight="bold">
                                {{ student.completed_sessions|default:20 }}
                            </text>
                            <text x="60" y="80" text-anchor="middle" dominant-baseline="middle" font-size="16">
                                / {{ student.total_sessions|default:24 }}
                            </text>
                        </svg>
                        <div class="sr-progress-percentage">{{ student.progress_percentage|default:84 }}%</div>
                    </div>
                    <div class="sr-sessions-details">
                        <h3>Last 5 sessions</h3>
                        <div class="sr-sessions-list">
                            <div class="sr-session-header">
                                <span>Date</span>
                                <span>Status</span>
                            </div>
                            {% for session in student.recent_sessions|default:'' %}
                            <div class="sr-session-item">
                                <span>{{ session.date }}</span>
                                <span class="sr-session-status sr-status-{{ session.status|lower }}">{{ session.status }}</span>
                            </div>
                            {% empty %}
                            <div class="sr-session-item">
                                <span>01 March</span>
                                <span class="sr-session-status sr-status-present">Present</span>
                            </div>
                            <div class="sr-session-item">
                                <span>24 Feb</span>
                                <span class="sr-session-status sr-status-missed">Missed</span>
                            </div>
                            <div class="sr-session-item">
                                <span>20 Feb</span>
                                <span class="sr-session-status sr-status-present">Present</span>
                            </div>
                            {% endfor %}
                        </div>
                        <a href="#" class="sr-view-all">All sessions <i class="fas fa-chevron-right"></i></a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Session Analytics Section -->
        <div class="sr-card">
            <div class="sr-card-header">Session analytics</div>
            <div class="sr-card-body">
                <div class="sr-analytics-tabs">
                    <button class="sr-tab-btn active" data-tab="attentiveness">Attentiveness</button>
                    <button class="sr-tab-btn" data-tab="attendance">Attendance</button>
                    <button class="sr-tab-btn" data-tab="talktime">Talktime</button>
                </div>
                
                <div class="sr-analytics-alert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Student's attentiveness has dropped over last 3 sessions</span>
                </div>
                
                <div class="sr-analytics-stats">
                    <div class="sr-stat-value">
                        <span class="sr-big-number">78%</span>
                        <span class="sr-stat-label">avg</span>
                    </div>
                    <div class="sr-stat-comparison">
                        <span class="sr-comparison-value">61%</span>
                        <span class="sr-comparison-label">in last 3 sessions</span>
                    </div>
                </div>
                
                <div class="sr-analytics-chart">
                    <div class="sr-chart-legend">
                        <div class="sr-legend-item">
                            <span class="sr-legend-color sr-color-student"></span>
                            <span>{{ student.first_name }} {{ student.last_name }}</span>
                        </div>
                        <div class="sr-legend-item">
                            <span class="sr-legend-color sr-color-avg"></span>
                            <span>Classroom Avg</span>
                        </div>
                    </div>
                    <div class="sr-chart-container">
                        <!-- Chart would be rendered by JavaScript -->
                        <div class="sr-chart-placeholder"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Sections -->
        <div class="sr-card">
            <div class="sr-card-header">Course Details</div>
            <div class="sr-card-body">
                <div class="sr-detail-grid">
                    <div class="sr-detail-item">
                        <span class="sr-detail-label">Course:</span>
                        <span class="sr-detail-value">{{ student.course.course_name }}</span>
                    </div>
                    <div class="sr-detail-item">
                        <span class="sr-detail-label">Trainer:</span>
                        <span class="sr-detail-value">{{ student.trainer.name }}</span>
                    </div>
                    <div class="sr-detail-item">
                        <span class="sr-detail-label">Status:</span>
                        <span class="sr-detail-value">{{ student.get_course_status_display }}</span>
                    </div>
                    <div class="sr-detail-item">
                        <span class="sr-detail-label">Start Date:</span>
                        <span class="sr-detail-value">{{ student.start_date|date:"d-m-Y" }}</span>
                    </div>
                    <div class="sr-detail-item">
                        <span class="sr-detail-label">End Date:</span>
                        <span class="sr-detail-value">{{ student.end_date|date:"d-m-Y" }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="sr-card">
            <div class="sr-card-header">Batch History</div>
            <div class="sr-card-body">
                {% if batch_history.current_batch %}
                <div class="sr-batch-section">
                    <h3>Current Batch</h3>
                    <div class="sr-batch-item">
                        <span class="sr-batch-id">{{ batch_history.current_batch.batch_id }}</span>
                        <span class="sr-batch-course">{{ batch_history.current_batch.course }}</span>
                    </div>
                </div>
                {% endif %}
                
                <div class="sr-batch-section">
                    <h3>Previous Batches</h3>
                    <div class="sr-batch-list">
                        {% for batch in batch_history.batch_history %}
                        <div class="sr-batch-item">
                            <span class="sr-batch-id">{{ batch.batch_id }}</span>
                            <span class="sr-batch-course">{{ batch.course }}</span>
                        </div>
                        {% empty %}
                        <p>No previous batches</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="sr-card">
            <div class="sr-card-header">Placement Details</div>
            <div class="sr-card-body">
                {% if placement %}
                <div class="sr-placement-details">
                    <div class="sr-placement-item">
                        <span class="sr-placement-label">Resume:</span>
                        <a href="{{ placement.resume_link.url }}" target="_blank" class="sr-resume-link">
                            <i class="fas fa-file-pdf"></i> View Resume
                        </a>
                    </div>
                    <div class="sr-placement-item">
                        <span class="sr-placement-label">Onboarding Call:</span>
                        <span class="sr-placement-status {% if student.onboardingcalldone %}sr-status-complete{% else %}sr-status-pending{% endif %}">
                            {{ student.onboardingcalldone|yesno:"Completed,Pending" }}
                        </span>
                    </div>
                    <div class="sr-placement-item">
                        <span class="sr-placement-label">Interview Questions:</span>
                        <span class="sr-placement-status {% if student.interviewquestion_shared %}sr-status-complete{% else %}sr-status-pending{% endif %}">
                            {{ student.interviewquestion_shared|yesno:"Shared,Not Shared" }}
                        </span>
                    </div>
                </div>
                {% else %}
                <p>No placement details available.</p>
                {% endif %}
            </div>
        </div>

        <div class="sr-card">
            <div class="sr-card-header">Interview Details</div>
            <div class="sr-card-body">
                {% if company_interview_data %}
                <div class="sr-interview-list">
                    {% for company_data in company_interview_data %}
                    <div class="sr-interview-company">
                        <h3>{{ company_data.company_name }}</h3>
                        <div class="sr-interview-stats">
                            <div class="sr-interview-stat">
                                <span class="sr-stat-label">Total Rounds:</span>
                                <span class="sr-stat-value">{{ company_data.total_rounds }}</span>
                            </div>
                            <div class="sr-interview-stat">
                                <span class="sr-stat-label">Status:</span>
                                <span class="sr-stat-value sr-status-{{ company_data.status|default:'in-progress'|lower }}">
                                    {{ company_data.status|default:"In Progress" }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p>No interview details available.</p>
                {% endif %}
            </div>
        </div>

        <div class="sr-card">
            <div class="sr-card-header">Payment Details</div>
            <div class="sr-card-body">
                {% if payment %}
                <div class="sr-payment-summary">
                    <div class="sr-payment-stat">
                        <span class="sr-payment-label">Total Fees</span>
                        <span class="sr-payment-value">₹{{ payment.total_fees }}</span>
                    </div>
                    <div class="sr-payment-stat">
                        <span class="sr-payment-label">Amount Paid</span>
                        <span class="sr-payment-value">₹{{ payment.amount_paid }}</span>
                    </div>
                    <div class="sr-payment-stat">
                        <span class="sr-payment-label">Pending Amount</span>
                        <span class="sr-payment-value">₹{{ payment.total_pending_amount }}</span>
                    </div>
                </div>
                <div class="sr-payment-status">
                    <div class="sr-payment-progress">
                        <div class="sr-progress-bar">
                            <div class="sr-progress-fill" style="width: {{ payment.payment_percentage|default:0 }}%;"></div>
                        </div>
                        <div class="sr-payment-percentage">{{ payment.payment_percentage|default:0 }}% Paid</div>
                    </div>
                    <div class="sr-payment-status-label {{ payment.get_payment_status|lower|cut:" " }}">
                        {{ payment.get_payment_status }}
                    </div>
                </div>
                {% else %}
                <p>No payment details available.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching functionality
        const tabButtons = document.querySelectorAll('.sr-tab-btn');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                tabButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Here you would normally switch content based on the tab
                const tabName = this.dataset.tab;
                console.log(`Switched to ${tabName} tab`);
            });
        });
    });
</script>
{% endblock %}