{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
<style>

/* Cards for Calendar & Chart */
.card {
    border-radius: 20px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    background-color: #ffffff;
}
.card-header {
    padding: 20px 25px;
    border-bottom: 1px solid #e0e0e0;
    font-weight: 600;
    font-size: 1.1rem;
    color: #0d3b66;
}
.card-body {
    padding: 25px;
}

/* Calendar */
#calendar {
    border-radius: 15px;
    overflow: hidden;
    background-color: #fefefe;
}

/* Doughnut Chart */
#finishingBatchesChart {
    height: 300px !important;
}

/* Blue Theme Gradients */
.bg-blue-gradient {
    background: linear-gradient(135deg, #1f77b4, #5592d4);
    color: #fff;
}

/* Responsive */
@media (max-width: 992px) {
    .stats-overview, .quick-actions {
        flex-direction: column;
    }
}

</style>
{% endblock %}

{% block title %}Batch Coordination Dashboard{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="row my-4 ms-1">
        <div class="col-md-12">
            <h2>Hey, {{ user.name }}!</h2>
        </div>
    </div>
    <div class="quick-actions">
        <a href="{% url 'student_list' %}" class="quick-action-btn">
            <i class="fas fa-user-graduate"></i>
            <span>All Students</span>
        </a>
        <a href="{% url 'batchdb:batch_list' %}" class="quick-action-btn">
            <i class="fas fa-users"></i>
            <span>All Batches</span>
        </a>
        <a href="{% url 'update_user' user.pk %}" class="quick-action-btn">
            <i class="fas fa-user-edit"></i>
            <span>Update Profile</span>
        </a>
        <a href="{% url 'trainer_list' %}" class="quick-action-btn">
            <i class="fas fa-chalkboard-teacher"></i>
            <span>All Trainers</span>
        </a>
    </div>

    <div class="stats-overview">
        <div class="stat-card">
            <div class="stat-header">
                <i class="fas fa-users stat-icon"></i>
                <h3 class="stat-title">Total Batches</h3>
            </div>
            <p class="stat-value">{{ total_batches }}</p>
        </div>
        <div class="stat-card">
            <div class="stat-header">
                <i class="far fa-clock stat-icon"></i>
                <h3 class="stat-title">Yet to Start</h3>
            </div>
            <p class="stat-value">{{ yts_batches }}</p>
        </div>
        <div class="stat-card">
            <div class="stat-header">
                <i class="fas fa-spinner stat-icon"></i>
                <h3 class="stat-title">In Progress</h3>
            </div>
            <p class="stat-value">{{ in_progress_batches }}</p>
        </div>
        <div class="stat-card">
            <div class="stat-header">
                <i class="fas fa-check-circle stat-icon"></i>
                <h3 class="stat-title">Completed</h3>
            </div>
            <p class="stat-value">{{ completed_batches }}</p>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4>Batch Completion Calendar</h4>
                </div>
                <div class="card-body">
                    <div id="calendar" style="height: 400px;"></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4>Batches Finishing This Month</h4>
                </div>
                <div class="card-body">
                    <canvas id="finishingBatchesChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.min.css">

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Donut Chart
    var ctx = document.getElementById('finishingBatchesChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: {{ finishing_batches_labels|safe }},
            datasets: [{
                data: {{ finishing_batches_data|safe }},
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'],
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // Batch Completion Calendar
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listWeek'
        },
        events: {{ batch_events|safe }},
        height: 650
    });
    calendar.render();
});
</script>
{% endblock %}